<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-2xl mx-auto px-4">
    <div class="mb-6">
      <button
        (click)="goBack()"
        class="flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors duration-200"
      >
        <lucide-icon [img]="ArrowLeft" class="w-5 h-5"></lucide-icon>
        Back to Category Management
      </button>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
      <h1 class="text-2xl font-bold text-gray-800 mb-6">Delete Category</h1>

      @if (isLoading) {
      <div class="flex justify-center py-8">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"></div>
      </div>
      } @else { @if (errorMessage) {
      <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-4">
        {{ errorMessage }}
      </div>
      } @if (categories.length === 0) {
      <div class="text-center py-8">
        <div class="flex items-center justify-center mb-4">
          <lucide-icon [img]="Package" class="w-12 h-12 text-gray-400"></lucide-icon>
        </div>
        <p class="text-gray-500 mb-4">No categories found for your market stall.</p>
        <button
          (click)="router.navigate(['/admin/category/create'])"
          class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition-colors duration-200"
        >
          Create First Category
        </button>
      </div>
      } @else { @if (!selectedCategory) {
      <div class="mb-6">
        <p class="text-gray-700 mb-4">Select a category to delete:</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          @for (category of categories; track category.id) {
          <button
            type="button"
            (click)="selectCategory(category)"
            class="p-4 border border-gray-300 rounded-md text-left hover:bg-gray-50 hover:border-red-300 transition-all duration-200"
          >
            <div class="flex items-start gap-3">
              @if (category.fotoUrl) {
              <img
                [src]="category.fotoUrl"
                [alt]="category.name"
                class="w-12 h-12 rounded-md object-cover"
              />
              } @else {
              <div class="w-12 h-12 bg-red-500 rounded-md flex items-center justify-center">
                <span class="text-white font-bold text-lg">{{
                  category.name.charAt(0).toUpperCase()
                }}</span>
              </div>
              }
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-gray-800">{{ category.name }}</h3>
                <p class="text-sm text-gray-600 mt-1 line-clamp-2">{{ category.description }}</p>
                @if (category.menus && category.menus.length > 0) {
                <p class="text-xs text-gray-500 mt-2">{{ category.menus.length }} menu items</p>
                }
              </div>
            </div>
          </button>
          }
        </div>
      </div>
      } @else {

      <div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6">
        <div class="flex items-center mb-3">
          <lucide-icon [img]="AlertTriangle" class="w-6 h-6 text-red-600 mr-2"></lucide-icon>
          <h2 class="text-lg font-semibold text-red-800">Confirm Deletion</h2>
        </div>
        <p class="text-red-700 mb-4">
          Are you sure you want to delete this category? This action cannot be undone and will also
          delete all associated menu items.
        </p>

        <div class="bg-white border border-red-300 rounded-md p-4">
          <div class="flex items-start gap-3">
            @if (selectedCategory.fotoUrl) {
            <img
              [src]="selectedCategory.fotoUrl"
              [alt]="selectedCategory.name"
              class="w-16 h-16 rounded-md object-cover"
            />
            } @else {
            <div class="w-16 h-16 bg-red-500 rounded-md flex items-center justify-center">
              <span class="text-white font-bold text-xl">{{
                selectedCategory.name.charAt(0).toUpperCase()
              }}</span>
            </div>
            }
            <div class="flex-1">
              <h3 class="font-bold text-gray-800 mb-2">{{ selectedCategory.name }}</h3>
              <p class="text-gray-600 text-sm mb-2">{{ selectedCategory.description }}</p>
              @if (selectedCategory.menus && selectedCategory.menus.length > 0) {
              <div class="mt-3">
                <p class="text-sm text-red-600 font-medium mb-2">
                  This will also delete {{ selectedCategory.menus.length }} menu items:
                </p>
                <div class="flex gap-2 flex-wrap">
                  @for (menu of selectedCategory.menus; track menu.id) {
                  <span class="bg-red-100 text-red-700 text-xs px-2 py-1 rounded-full">
                    {{ menu.name }}
                  </span>
                  }
                </div>
              </div>
              }
            </div>
          </div>
        </div>
      </div>

      <div class="flex gap-4">
        <button
          (click)="confirmDelete()"
          [disabled]="isDeleting"
          class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200"
        >
          @if (isDeleting) { Deleting... } @else { Yes, Delete Category }
        </button>
        <button
          type="button"
          (click)="selectedCategory = null"
          class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors duration-200"
        >
          Cancel
        </button>
      </div>
      } } }
    </div>
  </div>
</div>
